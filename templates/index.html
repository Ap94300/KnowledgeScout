<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>KnowledgeScout - App</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <nav class="topbar">
      <div class="brand"><img src="/static/9789367.png" alt="logo"> KnowledgeScout</div>
      <div class="nav-right">
        <span class="user">Hi, {{ username }}</span>
        <a class="btn small" href="/logout">Logout</a>
      </div>
    </nav>

    <main class="main">
      <div class="card layout">
        <div class="left">
          <h3>Upload document</h3>
          <p class="muted">PDF, DOCX or TXT. Uploaded only for your account.</p>
          <form id="uploadForm">
            <input type="file" name="file" id="fileInput" required>
            <button class="btn" type="submit">Upload & Process</button>
          </form>
          <div id="uploadStatus" class="muted"></div>

          <hr>
          <h3>Ask a question</h3>
          <input id="question" placeholder="Ask something from the uploaded document...">
          <button class="btn" onclick="askQuestion()">Ask</button>
          <div id="answer" class="answer-box">Answer will appear here</div>
        </div>
        <div class="right">
          <h4>Tips</h4>
          <ul>
            <li>Upload clear text documents for best results.</li>
            <li>Try short specific questions (Who, What, When, Where, How).</li>
            <li>If answers seem off, upload a clearer document or ask another question.</li>
          </ul>
          <h4>Your docs</h4>
          <div class="muted small">Your uploaded text is stored in server file: <code>/uploads/{{ username }}.txt</code></div>
        </div>
      </div>
    </main>

    <footer class="footer">
      Built for Skillion Hackathon Â· KnowledgeScout
    </footer>

    <script>
      document.getElementById("uploadForm").addEventListener("submit", async function(e){
        e.preventDefault();
        let f = document.getElementById("fileInput").files[0];
        if(!f){ alert("Choose a file"); return; }
        let fd = new FormData();
        fd.append("file", f);
        document.getElementById("uploadStatus").innerText = "Uploading...";
        let res = await fetch("/upload", { method: "POST", body: fd });
        let data = await res.json();
        document.getElementById("uploadStatus").innerText = data.message || "Uploaded";
      });

      async function askQuestion(){
        let q = document.getElementById("question").value.trim();
        if(!q){ alert("Type a question"); return; }
        document.getElementById("answer").innerText = "Thinking...";
        let res = await fetch("/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: q })
        });
        let data = await res.json();
        document.getElementById("answer").innerText = data.answer;
      }
    </script>
  </body>
</html>